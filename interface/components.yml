openapi: 3.0.3
info:
  title: ECG Orchestrator API â€” Shared Components
  version: 1.0.0
components:
  parameters:
    JtiParam:
      name: jti
      in: path
      required: true
      schema:
        type: string
        format: uuid
    ChallengeIdParam:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
  schemas:
    PairingInitRequest:
      type: object
      required:
        - deviceId
        - displayName
        - publicKeyPem
        - fcmToken
        - platform
      properties:
        deviceId:
          type: string
        displayName:
          type: string
        publicKeyPem:
          type: string
        fcmToken:
          type: string
        platform:
          $ref: '#/components/schemas/Platform'
        osVersion:
          type: string
        model:
          type: string
        attestation:
          $ref: '#/components/schemas/Attestation'
    PairingInitResponse:
      type: object
      required:
        - nonce
      properties:
        nonce:
          type: string
    PairingConfirmRequest:
      type: object
      required:
        - deviceId
        - signature
        - alg
      properties:
        deviceId:
          type: string
        signature:
          type: string
        alg:
          $ref: '#/components/schemas/EncryptionAlgo'
    DeviceInfo:
      type: object
      required:
        - deviceId
        - displayName
        - publicKeyPem
        - fcmToken
        - createdAt
      properties:
        deviceId:
          type: string
        displayName:
          type: string
        publicKeyPem:
          type: string
        fcmToken:
          type: string
        attestation:
          $ref: '#/components/schemas/Attestation'
        createdAt:
          type: integer
          format: int64
    Attestation:
      type: object
      properties:
        type:
          type: string
          enum:
            - play-integrity
            - safety-net
            - devicecheck
            - none
        verdict:
          type: string
        payload:
          type: object
          additionalProperties: true
    ChallengeCreateRequest:
      type: object
      required:
        - userId
      properties:
        userId:
          type: string
          format: uuid
        ttlSeconds:
          type: integer
          minimum: 30
          maximum: 300
          default: 120
    ChallengeCreateResponse:
      type: object
      required:
        - challengeId
      properties:
        challengeId:
          type: string
          format: uuid
    ChallengeCompleteRequest:
      type: object
      required:
        - assertionJwt
      properties:
        assertionJwt:
          type: string
          description: |
            JWS (ES256) signed by the device key. Claims: challengeId, nonce, aud, iat, biometricPassed, matchScore, deviceId.
        anything:
          type: string
    PairingCreateRequest:
      type: object
      required:
        - userId
      properties:
        userId:
          type: string
          format: uuid
    PairingCreateResponse:
      type: object
      required:
        - jti
        - jwt
      properties:
        jti:
          type: string
          format: uuid
        jwt:
          type: string
    StatusResponse:
      type: object
      required:
        - status
      properties:
        status:
          $ref: '#/components/schemas/FlowStatus'
        reason:
          type: string
    FlowStatus:
      type: string
      description: Lifecycle state of a challenge.
      enum:
       - CREATED
       - PENDING
       - APPROVED
       - DENIED
       - EXPIRED
       - NOT_FOUND
    Platform:
      type: string
      enum:
        - ANDROID
        - IOS
    EncryptionAlgo:
      type: string
      enum:
        - ES256

